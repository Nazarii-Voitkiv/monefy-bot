import type { Telegraf } from 'telegraf';

import type { BotContext } from '../context.js';

export function registerStartCommand(bot: Telegraf<BotContext>): void {
  bot.start(async (ctx) => {
    const name = ctx.from?.first_name ?? 'друже';
    await ctx.reply(
      [
        `Привіт, ${name}!`,
        'Я допомагаю вести облік витрат і доходів. Нижче коротка памʼятка по можливостях:',
        '',
        '1) Додавання транзакцій (пишеш просто в чат):',
        '   • `- 45.90 PLN coffee @2025-10-20` — витрата',
        '   • `+ 1200 UAH salary` — дохід',
        '   • знак: `+` або `-` (якщо немає — вважається витрата)',
        '   • валюти: `USD`, `PLN`, `UAH` (опційно)',
        '   • дата: `@YYYY-MM-DD` (опційно, якщо немає — сьогодні)',
        '   • категорія: обовʼязково (наприклад `coffee`)',
        '   • нотатка: будь-який текст наприкінці',
        '',
        '2) Команди для довідки та звітів:',
        '   /add — показати приклади формату додавання транзакцій',
        '   /today — статистика за сьогодні',
        '   /week — статистика за поточний тиждень',
        '   /month — статистика за поточний місяць',
        '   /stats <YYYY-MM> — звіт за місяць, напр. `/stats 2025-10`',
        '   /stats <from> <to> — звіт за діапазон, напр. `/stats 2025-10-01 2025-10-10`',
        '',
        '3) Категорії (керування):',
        '   /cat list — показати список категорій',
        '   /cat add <name> <expense|income> — додати категорію, напр. `/cat add coffee expense`',
        '   /cat rm <name> — видалити категорію (також працюють `remove` і `del`)',
        '',
        '4) Курси валют:',
        '   /rate <YYYY-MM-DD> — показати курс USD→PLN/UAH на вказану дату (якщо не вказано — сьогодні), напр. `/rate 2025-10-23`',
        '',
        'Інші нотатки:',
        '   • Категорії мають бути створені перед використанням у транзакції (див. `/cat add`).',
        '   • Підтримуються валюти: USD, PLN, UAH. Конвертація в USD зберігається автоматично.',
        '   • Щоб побачити приклади формату додавання — використай `/add`.'
      ].join('\n'),
      { parse_mode: 'Markdown' }
    );
  });
}
